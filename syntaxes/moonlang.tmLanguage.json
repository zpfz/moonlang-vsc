{
    "$schema": "https://raw.githubusercontent.com/martinring/tmlanguage/master/tmlanguage.json",
    "name": "MoonLang",
    "scopeName": "source.moonlang",
    "patterns": [
        { "include": "#comments" },
        { "include": "#strings" },
        { "include": "#numbers" },
        { "include": "#lambda" },
        { "include": "#function-definition" },
        { "include": "#class-definition" },
        { "include": "#keywords" },
        { "include": "#constants" },
        { "include": "#builtins" },
        { "include": "#method-call" },
        { "include": "#function-call" },
        { "include": "#operators" },
        { "include": "#variables" }
    ],
    "repository": {
        "comments": {
            "patterns": [
                {
                    "name": "comment.block.moonlang",
                    "begin": "#\\[\\[",
                    "end": "\\]\\]"
                },
                {
                    "name": "comment.line.number-sign.moonlang",
                    "match": "#.*$"
                }
            ]
        },
        "strings": {
            "patterns": [
                {
                    "name": "string.quoted.triple.moonlang",
                    "begin": "\"\"\"",
                    "end": "\"\"\"",
                    "patterns": [
                        {
                            "name": "constant.character.escape.moonlang",
                            "match": "\\\\."
                        }
                    ]
                },
                {
                    "name": "string.quoted.double.moonlang",
                    "begin": "\"",
                    "end": "\"",
                    "patterns": [
                        {
                            "name": "constant.character.escape.moonlang",
                            "match": "\\\\(n|r|t|\\\\|\"|'|0|x[0-9a-fA-F]{2})"
                        },
                        {
                            "name": "string.interpolated.moonlang",
                            "match": "\\{[^}]+\\}"
                        }
                    ]
                },
                {
                    "name": "string.quoted.single.moonlang",
                    "begin": "'",
                    "end": "'",
                    "patterns": [
                        {
                            "name": "constant.character.escape.moonlang",
                            "match": "\\\\."
                        }
                    ]
                }
            ]
        },
        "numbers": {
            "patterns": [
                {
                    "name": "constant.numeric.hex.moonlang",
                    "match": "\\b0[xX][0-9a-fA-F_]+\\b"
                },
                {
                    "name": "constant.numeric.binary.moonlang",
                    "match": "\\b0[bB][01_]+\\b"
                },
                {
                    "name": "constant.numeric.octal.moonlang",
                    "match": "\\b0[oO][0-7_]+\\b"
                },
                {
                    "name": "constant.numeric.float.moonlang",
                    "match": "\\b[0-9][0-9_]*\\.[0-9][0-9_]*([eE][+-]?[0-9_]+)?\\b"
                },
                {
                    "name": "constant.numeric.integer.moonlang",
                    "match": "\\b[0-9][0-9_]*\\b"
                }
            ]
        },
        "lambda": {
            "patterns": [
                {
                    "name": "meta.lambda.moonlang",
                    "match": "(\\()([^)]*)(\\))\\s*(=>)",
                    "captures": {
                        "1": { "name": "punctuation.definition.parameters.begin.moonlang" },
                        "2": { 
                            "patterns": [
                                {
                                    "name": "variable.parameter.moonlang",
                                    "match": "[a-zA-Z_][a-zA-Z0-9_]*"
                                },
                                {
                                    "name": "punctuation.separator.parameter.moonlang",
                                    "match": ","
                                }
                            ]
                        },
                        "3": { "name": "punctuation.definition.parameters.end.moonlang" },
                        "4": { "name": "storage.type.function.arrow.moonlang" }
                    }
                },
                {
                    "name": "storage.type.function.arrow.moonlang",
                    "match": "=>"
                }
            ]
        },
        "function-definition": {
            "patterns": [
                {
                    "name": "meta.function.moonlang",
                    "begin": "\\b(function)\\s+([a-zA-Z_][a-zA-Z0-9_]*)\\s*(\\()",
                    "beginCaptures": {
                        "1": { "name": "keyword.declaration.function.moonlang" },
                        "2": { "name": "entity.name.function.moonlang" },
                        "3": { "name": "punctuation.definition.parameters.begin.moonlang" }
                    },
                    "end": "(\\))\\s*(:|(\\{))",
                    "endCaptures": {
                        "1": { "name": "punctuation.definition.parameters.end.moonlang" },
                        "3": { "name": "punctuation.section.block.begin.moonlang" }
                    },
                    "patterns": [
                        {
                            "name": "variable.parameter.moonlang",
                            "match": "[a-zA-Z_][a-zA-Z0-9_]*"
                        },
                        {
                            "name": "punctuation.separator.parameter.moonlang",
                            "match": ","
                        },
                        {
                            "name": "keyword.operator.assignment.default.moonlang",
                            "match": "="
                        },
                        { "include": "#strings" },
                        { "include": "#numbers" },
                        { "include": "#constants" }
                    ]
                }
            ]
        },
        "class-definition": {
            "patterns": [
                {
                    "name": "meta.class.moonlang",
                    "match": "\\b(class)\\s+([a-zA-Z_][a-zA-Z0-9_]*)(?:\\s+(extends)\\s+([a-zA-Z_][a-zA-Z0-9_]*))?\\s*(:|(\\{))",
                    "captures": {
                        "1": { "name": "keyword.declaration.class.moonlang" },
                        "2": { "name": "entity.name.class.moonlang" },
                        "3": { "name": "keyword.other.extends.moonlang" },
                        "4": { "name": "entity.other.inherited-class.moonlang" },
                        "6": { "name": "punctuation.section.block.begin.moonlang" }
                    }
                },
                {
                    "name": "meta.class.simple.moonlang",
                    "match": "\\b(class)\\s+([a-zA-Z_][a-zA-Z0-9_]*)",
                    "captures": {
                        "1": { "name": "keyword.declaration.class.moonlang" },
                        "2": { "name": "entity.name.class.moonlang" }
                    }
                }
            ]
        },
        "keywords": {
            "patterns": [
                {
                    "name": "keyword.control.conditional.moonlang",
                    "match": "\\b(if|elif|else|switch|case|default)\\b"
                },
                {
                    "name": "keyword.control.loop.moonlang",
                    "match": "\\b(while|for|in|to|break|continue)\\b"
                },
                {
                    "name": "keyword.control.flow.moonlang",
                    "match": "\\b(return|throw|yield)\\b"
                },
                {
                    "name": "keyword.control.trycatch.moonlang",
                    "match": "\\b(try|catch|finally)\\b"
                },
                {
                    "name": "keyword.control.block.moonlang",
                    "match": "\\b(end)\\b"
                },
                {
                    "name": "punctuation.section.block.begin.moonlang",
                    "match": "(?<=[\\)\\s:])(\\{)(?=\\s*$)"
                },
                {
                    "name": "punctuation.section.block.end.moonlang",
                    "match": "^\\s*(\\})(?=\\s*$)"
                },
                {
                    "name": "keyword.declaration.moonlang",
                    "match": "\\b(function|class)\\b"
                },
                {
                    "name": "keyword.other.new.moonlang",
                    "match": "\\b(new)\\s+([a-zA-Z_][a-zA-Z0-9_]*)",
                    "captures": {
                        "1": { "name": "keyword.other.new.moonlang" },
                        "2": { "name": "entity.name.class.moonlang" }
                    }
                },
                {
                    "name": "keyword.control.import.moonlang",
                    "match": "\\b(import|from|as|export)\\b"
                },
                {
                    "name": "keyword.other.moonlang",
                    "match": "\\b(moon|extends)\\b"
                },
                {
                    "name": "keyword.other.async.moonlang",
                    "match": "\\b(chan|send|recv|async|await)\\b"
                },
                {
                    "name": "variable.language.this.moonlang",
                    "match": "\\b(self)\\b"
                },
                {
                    "name": "variable.language.super.moonlang",
                    "match": "\\b(super)\\b"
                },
                {
                    "name": "keyword.operator.logical.moonlang",
                    "match": "\\b(and|or|not)\\b"
                }
            ]
        },
        "operators": {
            "patterns": [
                {
                    "name": "keyword.operator.comparison.moonlang",
                    "match": "(===|!==|==|!=|<=|>=|<|>)"
                },
                {
                    "name": "keyword.operator.assignment.compound.moonlang",
                    "match": "(\\+=|-=|\\*=|/=|%=|\\^=|&=|\\|=)"
                },
                {
                    "name": "keyword.operator.assignment.moonlang",
                    "match": "="
                },
                {
                    "name": "keyword.operator.arithmetic.moonlang",
                    "match": "(\\+|-|\\*\\*|\\*|/|%)"
                },
                {
                    "name": "keyword.operator.bitwise.moonlang",
                    "match": "(&|\\||\\^|~|<<|>>)"
                },
                {
                    "name": "keyword.operator.concatenation.moonlang",
                    "match": "\\.\\."
                },
                {
                    "name": "keyword.operator.range.moonlang",
                    "match": "\\.\\.\\.?"
                },
                {
                    "name": "punctuation.accessor.moonlang",
                    "match": "\\."
                },
                {
                    "name": "punctuation.separator.moonlang",
                    "match": ","
                },
                {
                    "name": "punctuation.terminator.moonlang",
                    "match": ";"
                }
            ]
        },
        "method-call": {
            "patterns": [
                {
                    "match": "(\\.)([a-zA-Z_][a-zA-Z0-9_]*)(\\s*\\()",
                    "captures": {
                        "1": { "name": "punctuation.accessor.moonlang" },
                        "2": { "name": "support.function.moonlang" },
                        "3": { "name": "punctuation.definition.arguments.begin.moonlang" }
                    }
                },
                {
                    "match": "(\\.)([a-zA-Z_][a-zA-Z0-9_]*)(?!\\s*\\()",
                    "captures": {
                        "1": { "name": "punctuation.accessor.moonlang" },
                        "2": { "name": "variable.parameter.moonlang" }
                    }
                }
            ]
        },
        "function-call": {
            "patterns": [
                {
                    "match": "\\b([a-zA-Z_][a-zA-Z0-9_]*)(\\s*\\()",
                    "captures": {
                        "1": { "name": "entity.name.function.moonlang" },
                        "2": { "name": "punctuation.definition.arguments.begin.moonlang" }
                    }
                }
            ]
        },
        "builtins": {
            "patterns": [
                {
                    "name": "support.function.builtin.io.moonlang",
                    "match": "\\b(print|println|input|file_read|file_write|file_exists|file_delete|dir_create|dir_list|dir_delete|getcwd|chdir)(?=\\s*\\()"
                },
                {
                    "name": "support.function.builtin.type.moonlang",
                    "match": "\\b(type|typeof|instanceof|str|int|float|bool|list|dict)(?=\\s*\\()"
                },
                {
                    "name": "support.function.builtin.collection.moonlang",
                    "match": "\\b(len|append|pop|push|shift|unshift|slice|join|split|keys|values|has_key|delete_key|get|set|del|sort|reverse|range|first|last|unique|flatten|zip|enumerate|insert|remove|index|count|clear|copy|extend|sum|items)(?=\\s*\\()"
                },
                {
                    "name": "support.function.builtin.string.moonlang",
                    "match": "\\b(replace|upper|lower|to_upper|to_lower|trim|starts_with|ends_with|contains|index_of|substring|pad_left|pad_right|capitalize|title|ltrim|rtrim|repeat|chr|ord|format)(?=\\s*\\()"
                },
                {
                    "name": "support.function.builtin.functional.moonlang",
                    "match": "\\b(map|filter|reduce|each|find|any|all)(?=\\s*\\()"
                },
                {
                    "name": "support.function.builtin.math.moonlang",
                    "match": "\\b(min|max|abs|floor|ceil|round|sqrt|pow|sin|cos|tan|asin|acos|atan|atan2|log|log10|exp|random|random_int)(?=\\s*\\()"
                },
                {
                    "name": "support.constant.math.moonlang",
                    "match": "\\b(pi|e)\\b"
                },
                {
                    "name": "support.function.builtin.time.moonlang",
                    "match": "\\b(time|sleep|date|now|format_date|parse_date)(?=\\s*\\()"
                },
                {
                    "name": "support.function.builtin.json.moonlang",
                    "match": "\\b(json_encode|json_decode|json_parse|json_stringify)(?=\\s*\\()"
                },
                {
                    "name": "support.function.builtin.regex.moonlang",
                    "match": "\\b(regex_match|regex_find|regex_replace|regex_split|regex_compile)(?=\\s*\\()"
                },
                {
                    "name": "support.function.builtin.system.moonlang",
                    "match": "\\b(getenv|setenv|exec|exit|clone|merge|freeze|is_frozen|argv|platform|hostname)(?=\\s*\\()"
                },
                {
                    "name": "support.function.builtin.channel.moonlang",
                    "match": "\\b(chan|chan_send|chan_recv|chan_close)(?=\\s*\\()"
                },
                {
                    "name": "support.class.gui.moonlang",
                    "match": "\\b(Window|Tray|Widget)\\b"
                },
                {
                    "name": "support.function.gui.moonlang",
                    "match": "\\b(gui_init|gui_create|gui_run|gui_quit|gui_show|gui_hide|gui_load_html|gui_load_url|gui_set_title|gui_set_size|gui_set_position|gui_on_message|gui_on_close|gui_eval|gui_post_message|gui_alert|gui_confirm|gui_minimize|gui_maximize|gui_restore|gui_close|gui_tray_create|gui_tray_remove|gui_tray_set_menu|gui_tray_on_click|gui_expose|gui_bundle)(?=\\s*\\()"
                },
                {
                    "name": "support.function.network.moonlang",
                    "match": "\\b(http_get|http_post|http_request|tcp_connect|tcp_listen|tcp_accept|tcp_send|tcp_recv|tcp_close|udp_socket|udp_send|udp_recv)(?=\\s*\\()"
                },
                {
                    "name": "support.class.network.moonlang",
                    "match": "\\b(HttpServer|TcpServer|TcpClient)\\b"
                },
                {
                    "name": "support.function.async.moonlang",
                    "match": "\\b(set_timeout|set_interval|clear_timer|spawn|wait|select|wait_all|num_cpu)(?=\\s*\\()"
                },
                {
                    "name": "support.function.sync.moonlang",
                    "match": "\\b(sync_counter|sync_add|sync_get|sync_set|sync_cas|sync_mutex|sync_lock|sync_unlock|sync_trylock|sync_free)(?=\\s*\\()"
                },
                {
                    "name": "support.class.hal.moonlang",
                    "match": "\\b(GPIO|Pin|PWM|ADC|I2C|SPI|UART|Timer|Servo|DHT|OLED|NeoPixel|Stepper|Buzzer|Ultrasonic)\\b"
                },
                {
                    "name": "support.function.hal.moonlang",
                    "match": "\\b(hal_init|hal_deinit|gpio_init|gpio_read|gpio_write|gpio_set_mode|gpio_toggle|pwm_init|pwm_set_duty|pwm_set_freq|adc_init|adc_read|adc_read_voltage|i2c_init|i2c_write|i2c_read|i2c_write_reg|i2c_read_reg|spi_init|spi_transfer|spi_write|spi_read|uart_init|uart_write|uart_read|uart_available|uart_flush|delay_ms|delay_us|millis|micros|timer_init|timer_start|timer_stop|dht_read|oled_init|oled_clear|oled_print|oled_draw|neopixel_init|neopixel_set|neopixel_show|servo_init|servo_write|servo_read|stepper_init|stepper_step|buzzer_init|buzzer_tone|buzzer_stop|ultrasonic_read)(?=\\s*\\()"
                },
                {
                    "name": "support.constant.hal.moonlang",
                    "match": "\\b(INPUT|OUTPUT|INPUT_PULLUP|INPUT_PULLDOWN|HIGH|LOW|PULL_UP|PULL_DOWN|RISING|FALLING|CHANGE)\\b"
                },
                {
                    "name": "support.function.dll.moonlang",
                    "match": "\\b(dll_load|dll_call|dll_free|dll_export)(?=\\s*\\()"
                }
            ]
        },
        "constants": {
            "patterns": [
                {
                    "name": "constant.language.boolean.true.moonlang",
                    "match": "\\btrue\\b"
                },
                {
                    "name": "constant.language.boolean.false.moonlang",
                    "match": "\\bfalse\\b"
                },
                {
                    "name": "constant.language.null.moonlang",
                    "match": "\\b(null|nil|none)\\b"
                },
                {
                    "name": "constant.other.caps.moonlang",
                    "match": "\\b[A-Z][A-Z0-9_]{2,}\\b"
                }
            ]
        },
        "variables": {
            "patterns": [
                {
                    "name": "variable.other.moonlang",
                    "match": "\\b[a-zA-Z_][a-zA-Z0-9_]*\\b"
                }
            ]
        }
    }
}
